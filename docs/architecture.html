<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Agent - Architecture Documentation</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            padding: 1rem 2rem;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        /* Hero Section */
        .hero {
            padding: 8rem 2rem 4rem;
            text-align: center;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Sections */
        .section {
            padding: 4rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 2rem;
            background: var(--primary);
            border-radius: 2px;
        }

        /* Architecture Diagram */
        .architecture-container {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .architecture-diagram {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .layer {
            background: var(--bg-dark);
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .layer:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .layer.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .layer-name {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .layer-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            background: var(--primary);
            color: white;
        }

        .layer-components {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .component {
            background: var(--bg-card);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .component:hover {
            background: var(--bg-hover);
            border-color: var(--primary);
        }

        .component.selected {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Flow Arrows */
        .flow-arrow {
            display: flex;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 1.5rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(5px); }
        }

        /* Detail Panel */
        .detail-panel {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid var(--border);
            display: none;
        }

        .detail-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .detail-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .detail-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .detail-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .detail-section h4 {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }

        .detail-section p {
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .detail-section ul {
            list-style: none;
        }

        .detail-section li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-section li::before {
            content: '‚Üí';
            color: var(--primary);
        }

        /* Flow Diagram */
        .flow-container {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            min-width: 800px;
            padding: 1rem;
        }

        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .flow-box {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            text-align: center;
            min-width: 120px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .flow-box:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .flow-box.user { border-color: var(--secondary); }
        .flow-box.cli { border-color: var(--primary); }
        .flow-box.agent { border-color: var(--accent); }
        .flow-box.tools { border-color: var(--danger); }
        .flow-box.llm { border-color: #8b5cf6; }

        .flow-box-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .flow-box-label {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .flow-connector {
            color: var(--text-secondary);
            font-size: 1.5rem;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
        }

        .card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .card-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .card-files {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .card-file {
            background: var(--bg-dark);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-family: monospace;
            color: var(--text-secondary);
        }

        /* Interactive Flow Section */
        .interactive-flow {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .flow-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .flow-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: 2px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .flow-btn:hover, .flow-btn.active {
            border-color: var(--primary);
            background: var(--primary);
        }

        .flow-visualization {
            background: var(--bg-dark);
            border-radius: 0.75rem;
            padding: 2rem;
            min-height: 400px;
        }

        .flow-step-detail {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .flow-step-detail.active {
            display: block;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--primary);
            border-radius: 50%;
            margin-right: 0.75rem;
            font-weight: bold;
        }

        .step-content {
            margin-left: 2.75rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            border-left: 3px solid var(--primary);
        }

        .code-block {
            background: #0d1117;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Consolas', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-block .keyword { color: #ff79c6; }
        .code-block .string { color: #f1fa8c; }
        .code-block .function { color: #50fa7b; }
        .code-block .comment { color: #6272a4; }
        .code-block .class { color: #8be9fd; }

        /* Tools Section */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .tool-card {
            background: var(--bg-card);
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .tool-card:hover {
            border-color: var(--primary);
        }

        .tool-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-family: monospace;
        }

        .tool-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .hero-stats { flex-direction: column; gap: 1rem; }
            .detail-content { grid-template-columns: 1fr; }
            .nav-links { display: none; }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            border: 1px solid var(--border);
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .tab.active {
            color: var(--primary);
            background: var(--bg-card);
            border-bottom: 2px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <div class="nav-logo">Code Agent</div>
            <div class="nav-links">
                <a href="#overview">Overview</a>
                <a href="#architecture">Architecture</a>
                <a href="#flow">Flow</a>
                <a href="#components">Components</a>
                <a href="#tools">Tools</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Code Agent Architecture</h1>
        <p>A comprehensive AI-powered development environment built with clean architecture principles</p>
        <div class="hero-stats">
            <div class="stat">
                <div class="stat-value">68+</div>
                <div class="stat-label">Tools</div>
            </div>
            <div class="stat">
                <div class="stat-value">31</div>
                <div class="stat-label">Features</div>
            </div>
            <div class="stat">
                <div class="stat-value">6</div>
                <div class="stat-label">Layers</div>
            </div>
            <div class="stat">
                <div class="stat-value">60+</div>
                <div class="stat-label">Modules</div>
            </div>
        </div>
    </section>

    <!-- Overview Section -->
    <section id="overview" class="section">
        <h2 class="section-title">System Overview</h2>

        <div class="flow-container">
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-box user">
                        <div class="flow-box-icon">üë§</div>
                        <div class="flow-box-label">User</div>
                    </div>
                </div>
                <div class="flow-connector">‚Üí</div>
                <div class="flow-step">
                    <div class="flow-box cli">
                        <div class="flow-box-icon">üíª</div>
                        <div class="flow-box-label">CLI / API</div>
                    </div>
                </div>
                <div class="flow-connector">‚Üí</div>
                <div class="flow-step">
                    <div class="flow-box agent">
                        <div class="flow-box-icon">ü§ñ</div>
                        <div class="flow-box-label">Coding Agent</div>
                    </div>
                </div>
                <div class="flow-connector">‚Üí</div>
                <div class="flow-step">
                    <div class="flow-box llm">
                        <div class="flow-box-icon">üß†</div>
                        <div class="flow-box-label">LLM (Claude/Ollama)</div>
                    </div>
                </div>
                <div class="flow-connector">‚Üí</div>
                <div class="flow-step">
                    <div class="flow-box tools">
                        <div class="flow-box-icon">üîß</div>
                        <div class="flow-box-label">Tools</div>
                    </div>
                </div>
                <div class="flow-connector">‚Üí</div>
                <div class="flow-step">
                    <div class="flow-box" style="border-color: #10b981;">
                        <div class="flow-box-icon">üìÅ</div>
                        <div class="flow-box-label">File System</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Architecture Section -->
    <section id="architecture" class="section">
        <h2 class="section-title">Clean Architecture Layers</h2>

        <div class="architecture-container">
            <div class="architecture-diagram">
                <!-- Presentation Layer -->
                <div class="layer" data-layer="presentation" onclick="showLayerDetail('presentation')">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span>üñ•Ô∏è</span> Presentation Layer
                        </div>
                        <div class="layer-badge">Entry Points</div>
                    </div>
                    <div class="layer-components">
                        <div class="component">cli.py</div>
                        <div class="component">api/server.py</div>
                        <div class="component">core/tui.py</div>
                        <div class="component">core/visual_output.py</div>
                    </div>
                </div>

                <div class="flow-arrow">‚Üì</div>

                <!-- Application Layer -->
                <div class="layer" data-layer="application" onclick="showLayerDetail('application')">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span>ü§ñ</span> Application Layer
                        </div>
                        <div class="layer-badge">Agents & Workflows</div>
                    </div>
                    <div class="layer-components">
                        <div class="component">agents/coding_agent.py</div>
                        <div class="component">agents/specialized.py</div>
                        <div class="component">workflows/task_manager.py</div>
                        <div class="component">workflows/notebook.py</div>
                        <div class="component">planning/planner.py</div>
                    </div>
                </div>

                <div class="flow-arrow">‚Üì</div>

                <!-- Domain Layer -->
                <div class="layer" data-layer="domain" onclick="showLayerDetail('domain')">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span>‚öôÔ∏è</span> Domain Layer
                        </div>
                        <div class="layer-badge">Business Logic</div>
                    </div>
                    <div class="layer-components">
                        <div class="component">core/llm.py</div>
                        <div class="component">core/base_agent.py</div>
                        <div class="component">core/memory.py</div>
                        <div class="component">core/codebase_index.py</div>
                        <div class="component">context/attachments.py</div>
                        <div class="component">rules/agent_rules.py</div>
                    </div>
                </div>

                <div class="flow-arrow">‚Üì</div>

                <!-- Infrastructure Layer -->
                <div class="layer" data-layer="infrastructure" onclick="showLayerDetail('infrastructure')">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span>üîß</span> Infrastructure Layer
                        </div>
                        <div class="layer-badge">Tools & External Services</div>
                    </div>
                    <div class="layer-components">
                        <div class="component">tools/terminal.py</div>
                        <div class="component">tools/file_ops.py</div>
                        <div class="component">tools/git_tools.py</div>
                        <div class="component">tools/code_search.py</div>
                        <div class="component">tools/code_sandbox.py</div>
                        <div class="component">tools/human_input.py</div>
                        <div class="component">tools/build_fix.py</div>
                        <div class="component">tools/error_fixer.py</div>
                    </div>
                </div>

                <div class="flow-arrow">‚Üì</div>

                <!-- Core Services Layer -->
                <div class="layer" data-layer="services" onclick="showLayerDetail('services')">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span>üõ†Ô∏è</span> Core Services
                        </div>
                        <div class="layer-badge">Utilities & Features</div>
                    </div>
                    <div class="layer-components">
                        <div class="component">core/project_detector.py</div>
                        <div class="component">core/test_runner.py</div>
                        <div class="component">core/linter.py</div>
                        <div class="component">core/doc_generator.py</div>
                        <div class="component">core/refactoring.py</div>
                        <div class="component">core/secret_scanner.py</div>
                        <div class="component">core/docker_tools.py</div>
                        <div class="component">core/database_tools.py</div>
                    </div>
                </div>

                <div class="flow-arrow">‚Üì</div>

                <!-- Configuration Layer -->
                <div class="layer" data-layer="config" onclick="showLayerDetail('config')">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span>‚ö°</span> Configuration & Persistence
                        </div>
                        <div class="layer-badge">Settings & Storage</div>
                    </div>
                    <div class="layer-components">
                        <div class="component">config/settings.py</div>
                        <div class="component">memory/session.py</div>
                        <div class="component">core/session_manager.py</div>
                        <div class="component">core/checkpoint.py</div>
                        <div class="component">core/profiles.py</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detail Panel -->
        <div id="detail-panel" class="detail-panel">
            <div class="detail-header">
                <h3 class="detail-title" id="detail-title">Layer Details</h3>
                <button class="detail-close" onclick="hideDetail()">√ó</button>
            </div>
            <div class="detail-content" id="detail-content">
                <!-- Filled by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Flow Section -->
    <section id="flow" class="section">
        <h2 class="section-title">Request Flow</h2>

        <div class="interactive-flow">
            <div class="flow-controls">
                <button class="flow-btn active" onclick="showFlow('user-request')">User Request</button>
                <button class="flow-btn" onclick="showFlow('tool-execution')">Tool Execution</button>
                <button class="flow-btn" onclick="showFlow('streaming')">Response Streaming</button>
                <button class="flow-btn" onclick="showFlow('human-loop')">Human-in-Loop</button>
            </div>

            <div class="flow-visualization">
                <!-- User Request Flow -->
                <div id="flow-user-request" class="flow-step-detail active">
                    <h3><span class="step-number">1</span> User Input</h3>
                    <div class="step-content">
                        <p>User types a command or request in the CLI</p>
                        <div class="code-block">
                            <span class="comment"># User types in terminal:</span><br>
                            <span class="string">"Create a Python FastAPI project with user authentication"</span>
                        </div>
                    </div>

                    <h3><span class="step-number">2</span> CLI Processing</h3>
                    <div class="step-content">
                        <p>CLI receives input and initializes status display</p>
                        <div class="code-block">
                            <span class="comment"># cli.py - Main loop</span><br>
                            <span class="keyword">with</span> <span class="class">AgentStatusDisplay</span>() <span class="keyword">as</span> status:<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> chunk <span class="keyword">in</span> agent.<span class="function">run</span>(user_input, stream=<span class="keyword">True</span>):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status.<span class="function">update_from_chunk</span>(chunk)
                        </div>
                    </div>

                    <h3><span class="step-number">3</span> Agent Processing</h3>
                    <div class="step-content">
                        <p>CodingAgent sends request to LLM with context and available tools</p>
                        <div class="code-block">
                            <span class="comment"># coding_agent.py</span><br>
                            <span class="keyword">class</span> <span class="class">CodingAgent</span>:<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span> <span class="function">run</span>(self, message, stream=True):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> self.agent.<span class="function">run</span>(message, stream=stream)
                        </div>
                    </div>

                    <h3><span class="step-number">4</span> LLM Decision</h3>
                    <div class="step-content">
                        <p>LLM (Claude/Ollama) analyzes request and decides which tools to use</p>
                        <div class="code-block">
                            <span class="comment"># LLM Response:</span><br>
                            <span class="string">"I'll create the project structure using these tools:"</span><br>
                            <span class="comment"># Tool calls: create_file, write_file, run_terminal_command</span>
                        </div>
                    </div>

                    <h3><span class="step-number">5</span> Response Streaming</h3>
                    <div class="step-content">
                        <p>Response streams back to user with real-time tool execution display</p>
                        <div class="code-block">
                            <span class="comment"># Output:</span><br>
                            ‚†ã Creating: main.py<br>
                            ‚†ô Writing: requirements.txt<br>
                            ‚†π Running: `pip install fastapi`<br>
                            <br>
                            <span class="string">Agent: I've created your FastAPI project...</span>
                        </div>
                    </div>
                </div>

                <!-- Tool Execution Flow -->
                <div id="flow-tool-execution" class="flow-step-detail">
                    <h3><span class="step-number">1</span> Tool Selection</h3>
                    <div class="step-content">
                        <p>LLM selects appropriate tool based on the task</p>
                        <div class="code-block">
                            <span class="comment"># Available tools (68+):</span><br>
                            TERMINAL_TOOLS + FILE_TOOLS + GIT_TOOLS + <br>
                            SEARCH_TOOLS + SANDBOX_TOOLS + HUMAN_INPUT_TOOLS + ...
                        </div>
                    </div>

                    <h3><span class="step-number">2</span> Tool Logging</h3>
                    <div class="step-content">
                        <p>Tool logger displays real-time activity</p>
                        <div class="code-block">
                            <span class="comment"># tool_logger.py</span><br>
                            <span class="keyword">def</span> <span class="function">log_tool_call</span>(tool_name, **kwargs):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;console.<span class="function">print</span>(<span class="string">f"  > {display}: {path}"</span>)
                        </div>
                    </div>

                    <h3><span class="step-number">3</span> Tool Execution</h3>
                    <div class="step-content">
                        <p>Tool executes and returns result</p>
                        <div class="code-block">
                            <span class="comment"># file_ops.py</span><br>
                            <span class="keyword">@tool</span>(name=<span class="string">"write_file"</span>)<br>
                            <span class="keyword">def</span> <span class="function">write_file</span>(file_path, content):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="function">log_tool_call</span>(<span class="string">"write_file"</span>, file_path=file_path)<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;path.<span class="function">write_text</span>(content)<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="string">f"Successfully created: {path}"</span>
                        </div>
                    </div>

                    <h3><span class="step-number">4</span> Activity Summary</h3>
                    <div class="step-content">
                        <p>Summary displayed after all tools complete</p>
                        <div class="code-block">
                            ‚îå‚îÄ Summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê<br>
                            ‚îÇ Completed in 3.2s                ‚îÇ<br>
                            ‚îÇ ‚óà Created: main.py, config.py    ‚îÇ<br>
                            ‚îÇ ‚óà Ran: `pip install fastapi`     ‚îÇ<br>
                            ‚îÇ ‚óà Git: Init, Commit              ‚îÇ<br>
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        </div>
                    </div>
                </div>

                <!-- Streaming Flow -->
                <div id="flow-streaming" class="flow-step-detail">
                    <h3><span class="step-number">1</span> Stream Initialization</h3>
                    <div class="step-content">
                        <p>Agent starts streaming response chunks</p>
                        <div class="code-block">
                            <span class="comment"># Agno framework streams from LLM</span><br>
                            <span class="keyword">for</span> chunk <span class="keyword">in</span> agent.<span class="function">run</span>(message, stream=<span class="keyword">True</span>):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># Each chunk contains partial response</span>
                        </div>
                    </div>

                    <h3><span class="step-number">2</span> Chunk Processing</h3>
                    <div class="step-content">
                        <p>Each chunk is processed for content and tool calls</p>
                        <div class="code-block">
                            <span class="keyword">if</span> <span class="function">hasattr</span>(chunk, <span class="string">'content'</span>) <span class="keyword">and</span> chunk.content:<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="function">print</span>(chunk.content, end=<span class="string">""</span>, flush=<span class="keyword">True</span>)<br><br>
                            <span class="keyword">if</span> <span class="function">hasattr</span>(chunk, <span class="string">'tool_calls'</span>):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;status.<span class="function">update_from_chunk</span>(chunk)
                        </div>
                    </div>

                    <h3><span class="step-number">3</span> Real-time Display</h3>
                    <div class="step-content">
                        <p>Output appears immediately with flush=True</p>
                        <div class="code-block">
                            <span class="comment"># User sees character by character:</span><br>
                            I<br>
                            I'<br>
                            I'l<br>
                            I'll<br>
                            I'll c<br>
                            I'll cr<br>
                            I'll cre<br>
                            I'll crea<br>
                            I'll creat<br>
                            I'll create...<br>
                        </div>
                    </div>
                </div>

                <!-- Human in Loop Flow -->
                <div id="flow-human-loop" class="flow-step-detail">
                    <h3><span class="step-number">1</span> Agent Needs Input</h3>
                    <div class="step-content">
                        <p>Agent uses ask_user tool for clarification</p>
                        <div class="code-block">
                            <span class="comment"># human_input.py</span><br>
                            <span class="keyword">@tool</span>(name=<span class="string">"ask_user"</span>)<br>
                            <span class="keyword">def</span> <span class="function">ask_user</span>(question, options=None):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># Displays interactive prompt</span>
                        </div>
                    </div>

                    <h3><span class="step-number">2</span> Interactive Prompt</h3>
                    <div class="step-content">
                        <p>User sees formatted question with options</p>
                        <div class="code-block">
                            ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ<br>
                            ‚îÇ Agent Question:                     ‚îÇ<br>
                            ‚îÇ                                     ‚îÇ<br>
                            ‚îÇ Which database should I use?        ‚îÇ<br>
                            ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ<br>
                            <br>
                            Options:<br>
                            &nbsp;&nbsp;1. PostgreSQL<br>
                            &nbsp;&nbsp;2. MySQL<br>
                            &nbsp;&nbsp;3. SQLite<br>
                            <br>
                            Your answer: _
                        </div>
                    </div>

                    <h3><span class="step-number">3</span> Confirmation Required</h3>
                    <div class="step-content">
                        <p>Dangerous actions require explicit confirmation</p>
                        <div class="code-block">
                            ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Confirmation Required ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ<br>
                            ‚îÇ                                   ‚îÇ<br>
                            ‚îÇ Action: Delete 15 temporary files ‚îÇ<br>
                            ‚îÇ                                   ‚îÇ<br>
                            ‚îÇ This cannot be undone!            ‚îÇ<br>
                            ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ<br>
                            <br>
                            Proceed with this action? [y/N]: _
                        </div>
                    </div>

                    <h3><span class="step-number">4</span> Agent Continues</h3>
                    <div class="step-content">
                        <p>Agent receives response and continues execution</p>
                        <div class="code-block">
                            <span class="comment"># User confirmed, agent proceeds</span><br>
                            <span class="string">[OK] Confirmed</span><br><br>
                            ‚†ã Deleting: temp/file1.tmp<br>
                            ‚†ô Deleting: temp/file2.tmp<br>
                            ...<br>
                            <span class="string">Agent: I've cleaned up 15 temporary files.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Components Section -->
    <section id="components" class="section">
        <h2 class="section-title">Key Components</h2>

        <div class="tabs">
            <button class="tab active" onclick="showTab('agents')">Agents</button>
            <button class="tab" onclick="showTab('tools')">Tools</button>
            <button class="tab" onclick="showTab('core')">Core</button>
            <button class="tab" onclick="showTab('features')">Features</button>
        </div>

        <div id="tab-agents" class="tab-content active">
            <div class="cards-grid">
                <div class="card">
                    <div class="card-icon">ü§ñ</div>
                    <div class="card-title">CodingAgent</div>
                    <div class="card-description">Main orchestrator that combines all tools and capabilities. Handles user requests and coordinates tool execution.</div>
                    <div class="card-files">
                        <span class="card-file">agents/coding_agent.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üîç</div>
                    <div class="card-title">CodeReviewerAgent</div>
                    <div class="card-description">Specialized agent for in-depth code analysis and review suggestions.</div>
                    <div class="card-files">
                        <span class="card-file">agents/specialized.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üêõ</div>
                    <div class="card-title">DebuggerAgent</div>
                    <div class="card-description">Helps investigate and fix bugs with intelligent error analysis.</div>
                    <div class="card-files">
                        <span class="card-file">agents/specialized.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üîÑ</div>
                    <div class="card-title">RefactoringAgent</div>
                    <div class="card-description">Suggests code improvements and refactoring opportunities.</div>
                    <div class="card-files">
                        <span class="card-file">agents/specialized.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üß™</div>
                    <div class="card-title">TestWriterAgent</div>
                    <div class="card-description">Generates test suites and test cases for your code.</div>
                    <div class="card-files">
                        <span class="card-file">agents/specialized.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üìö</div>
                    <div class="card-title">DocumentationAgent</div>
                    <div class="card-description">Creates documentation, README files, and API docs.</div>
                    <div class="card-files">
                        <span class="card-file">agents/specialized.py</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-tools" class="tab-content">
            <div class="tools-grid">
                <div class="tool-card">
                    <div class="tool-name">read_file</div>
                    <div class="tool-desc">Read file contents with line numbers</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">write_file</div>
                    <div class="tool-desc">Create or overwrite files</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">edit_file</div>
                    <div class="tool-desc">Surgical edits to specific content</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">run_terminal_command</div>
                    <div class="tool-desc">Execute shell commands</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">git_status</div>
                    <div class="tool-desc">Check repository state</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">git_commit</div>
                    <div class="tool-desc">Commit changes with message</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">search_files</div>
                    <div class="tool-desc">Search for patterns in code</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">python_exec</div>
                    <div class="tool-desc">Execute Python in sandbox</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">ask_user</div>
                    <div class="tool-desc">Get input from user</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">confirm_action</div>
                    <div class="tool-desc">Confirm dangerous operations</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">build_project</div>
                    <div class="tool-desc">Build with error analysis</div>
                </div>
                <div class="tool-card">
                    <div class="tool-name">test_project</div>
                    <div class="tool-desc">Run project tests</div>
                </div>
            </div>
        </div>

        <div id="tab-core" class="tab-content">
            <div class="cards-grid">
                <div class="card">
                    <div class="card-icon">üß†</div>
                    <div class="card-title">LLM Integration</div>
                    <div class="card-description">Supports both Anthropic Claude and Ollama for local models. Configurable via environment.</div>
                    <div class="card-files">
                        <span class="card-file">core/llm.py</span>
                        <span class="card-file">core/model_providers.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Visual Output</div>
                    <div class="card-description">Rich terminal output with spinners, progress bars, and formatted panels.</div>
                    <div class="card-files">
                        <span class="card-file">core/visual_output.py</span>
                        <span class="card-file">core/tool_logger.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üíæ</div>
                    <div class="card-title">Session Management</div>
                    <div class="card-description">Persistent sessions with SQLite storage and conversation history.</div>
                    <div class="card-files">
                        <span class="card-file">core/session_manager.py</span>
                        <span class="card-file">memory/session.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üìù</div>
                    <div class="card-title">Planning System</div>
                    <div class="card-description">Multi-step task planning with progress tracking and step execution.</div>
                    <div class="card-files">
                        <span class="card-file">planning/planner.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üìé</div>
                    <div class="card-title">Context Attachments</div>
                    <div class="card-description">Attach files and folders to provide context to the agent.</div>
                    <div class="card-files">
                        <span class="card-file">context/attachments.py</span>
                        <span class="card-file">core/smart_context.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üìè</div>
                    <div class="card-title">Project Rules</div>
                    <div class="card-description">Custom rules via AGENT.md for project-specific guidelines.</div>
                    <div class="card-files">
                        <span class="card-file">rules/agent_rules.py</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-features" class="tab-content">
            <div class="cards-grid">
                <div class="card">
                    <div class="card-icon">üîÑ</div>
                    <div class="card-title">Checkpoint & Restore</div>
                    <div class="card-description">Save and restore project state with full undo/redo support.</div>
                    <div class="card-files">
                        <span class="card-file">core/checkpoint.py</span>
                        <span class="card-file">core/undo_redo.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üëÅÔ∏è</div>
                    <div class="card-title">Watch Mode</div>
                    <div class="card-description">Monitor file changes and react automatically.</div>
                    <div class="card-files">
                        <span class="card-file">core/watch_mode.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üîå</div>
                    <div class="card-title">Plugin System</div>
                    <div class="card-description">Extend functionality with custom plugins.</div>
                    <div class="card-files">
                        <span class="card-file">core/plugins.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üîê</div>
                    <div class="card-title">Secret Scanner</div>
                    <div class="card-description">Detect exposed credentials and API keys.</div>
                    <div class="card-files">
                        <span class="card-file">core/secret_scanner.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üê≥</div>
                    <div class="card-title">Docker Integration</div>
                    <div class="card-description">Manage containers and Docker workflows.</div>
                    <div class="card-files">
                        <span class="card-file">core/docker_tools.py</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">üìà</div>
                    <div class="card-title">Metrics Dashboard</div>
                    <div class="card-description">Project overview with code metrics and statistics.</div>
                    <div class="card-files">
                        <span class="card-file">core/metrics_dashboard.py</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Tools Section -->
    <section id="tools" class="section">
        <h2 class="section-title">Tool Categories</h2>

        <div class="cards-grid">
            <div class="card" style="border-left: 4px solid #10b981;">
                <div class="card-icon">üìÅ</div>
                <div class="card-title">File Operations</div>
                <div class="card-description">
                    <strong>7 tools</strong> for file manipulation:<br>
                    read, write, edit, create, delete, move, copy
                </div>
                <div class="card-files">
                    <span class="card-file">tools/file_ops.py</span>
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #6366f1;">
                <div class="card-icon">üíª</div>
                <div class="card-title">Terminal Operations</div>
                <div class="card-description">
                    <strong>3 tools</strong> for shell commands:<br>
                    run_command, change_directory, list_directory
                </div>
                <div class="card-files">
                    <span class="card-file">tools/terminal.py</span>
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #f59e0b;">
                <div class="card-icon">üîÄ</div>
                <div class="card-title">Git Operations</div>
                <div class="card-description">
                    <strong>10+ tools</strong> for version control:<br>
                    status, diff, add, commit, push, pull, branch, stash
                </div>
                <div class="card-files">
                    <span class="card-file">tools/git_tools.py</span>
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #ef4444;">
                <div class="card-icon">üîç</div>
                <div class="card-title">Code Search</div>
                <div class="card-description">
                    <strong>5 tools</strong> for searching code:<br>
                    search_files, find_in_files, grep_search, find_definition
                </div>
                <div class="card-files">
                    <span class="card-file">tools/code_search.py</span>
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #8b5cf6;">
                <div class="card-icon">üêç</div>
                <div class="card-title">Python Sandbox</div>
                <div class="card-description">
                    <strong>6 tools</strong> for Python REPL:<br>
                    exec, eval, import, vars, run_file, reset
                </div>
                <div class="card-files">
                    <span class="card-file">tools/code_sandbox.py</span>
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #ec4899;">
                <div class="card-icon">üë§</div>
                <div class="card-title">Human Input</div>
                <div class="card-description">
                    <strong>5 tools</strong> for user interaction:<br>
                    ask_user, confirm_action, show_options, request_content, notify
                </div>
                <div class="card-files">
                    <span class="card-file">tools/human_input.py</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>Code Agent Architecture Documentation</p>
        <p style="margin-top: 0.5rem; font-size: 0.875rem;">Built with Clean Architecture Principles</p>
    </footer>

    <script>
        // Layer detail data
        const layerDetails = {
            presentation: {
                title: 'üñ•Ô∏è Presentation Layer',
                description: 'Entry points for user interaction. Handles input/output and user interface.',
                responsibilities: [
                    'CLI command parsing and routing',
                    'API endpoint handling',
                    'Terminal UI rendering',
                    'Visual feedback (spinners, progress)',
                    'User input collection'
                ],
                files: [
                    { name: 'cli.py', desc: 'Main CLI interface with 31 commands' },
                    { name: 'api/server.py', desc: 'FastAPI server with REST and WebSocket' },
                    { name: 'core/tui.py', desc: 'Terminal User Interface' },
                    { name: 'core/visual_output.py', desc: 'Rich output formatting' }
                ]
            },
            application: {
                title: 'ü§ñ Application Layer',
                description: 'Orchestrates agents and workflows. Contains use case implementations.',
                responsibilities: [
                    'Agent orchestration and coordination',
                    'Workflow and task management',
                    'Planning and step execution',
                    'Tool selection and invocation',
                    'Specialized agent delegation'
                ],
                files: [
                    { name: 'agents/coding_agent.py', desc: 'Main agent with 68+ tools' },
                    { name: 'agents/specialized.py', desc: '6 specialized agents' },
                    { name: 'workflows/task_manager.py', desc: 'Task and workflow tracking' },
                    { name: 'planning/planner.py', desc: 'Multi-step planning system' }
                ]
            },
            domain: {
                title: '‚öôÔ∏è Domain Layer',
                description: 'Core business logic and domain models. Framework-agnostic.',
                responsibilities: [
                    'LLM communication and streaming',
                    'Base agent abstraction',
                    'Memory and context management',
                    'Codebase indexing',
                    'Rule engine and validation'
                ],
                files: [
                    { name: 'core/llm.py', desc: 'LLM provider abstraction' },
                    { name: 'core/base_agent.py', desc: 'Agent base class' },
                    { name: 'core/memory.py', desc: 'Conversation memory' },
                    { name: 'context/attachments.py', desc: 'Context attachment system' }
                ]
            },
            infrastructure: {
                title: 'üîß Infrastructure Layer',
                description: 'External service integration. Tools that interact with the system.',
                responsibilities: [
                    'File system operations',
                    'Terminal command execution',
                    'Git repository management',
                    'Code search and analysis',
                    'User interaction prompts'
                ],
                files: [
                    { name: 'tools/file_ops.py', desc: '7 file operation tools' },
                    { name: 'tools/terminal.py', desc: 'Shell command execution' },
                    { name: 'tools/git_tools.py', desc: '10+ Git operations' },
                    { name: 'tools/human_input.py', desc: 'Human-in-loop tools' }
                ]
            },
            services: {
                title: 'üõ†Ô∏è Core Services',
                description: 'Utility services and feature implementations.',
                responsibilities: [
                    'Project type detection',
                    'Test running and coverage',
                    'Code linting and formatting',
                    'Documentation generation',
                    'Security scanning'
                ],
                files: [
                    { name: 'core/project_detector.py', desc: 'Auto-detect project type' },
                    { name: 'core/test_runner.py', desc: 'Test execution and reporting' },
                    { name: 'core/linter.py', desc: 'Code quality checking' },
                    { name: 'core/secret_scanner.py', desc: 'Credential detection' }
                ]
            },
            config: {
                title: '‚ö° Configuration & Persistence',
                description: 'Settings management and data persistence.',
                responsibilities: [
                    'Environment configuration',
                    'Session persistence',
                    'Checkpoint and restore',
                    'Profile management',
                    'Database operations'
                ],
                files: [
                    { name: 'config/settings.py', desc: 'Pydantic settings from .env' },
                    { name: 'core/session_manager.py', desc: 'SQLite session storage' },
                    { name: 'core/checkpoint.py', desc: 'Project state snapshots' },
                    { name: 'core/profiles.py', desc: 'User profiles and presets' }
                ]
            }
        };

        // Show layer detail
        function showLayerDetail(layer) {
            const data = layerDetails[layer];
            const panel = document.getElementById('detail-panel');
            const title = document.getElementById('detail-title');
            const content = document.getElementById('detail-content');

            title.textContent = data.title;

            content.innerHTML = `
                <div class="detail-section">
                    <h4>Description</h4>
                    <p>${data.description}</p>
                    <h4>Responsibilities</h4>
                    <ul>
                        ${data.responsibilities.map(r => `<li>${r}</li>`).join('')}
                    </ul>
                </div>
                <div class="detail-section">
                    <h4>Key Files</h4>
                    <ul>
                        ${data.files.map(f => `<li><strong>${f.name}</strong> - ${f.desc}</li>`).join('')}
                    </ul>
                </div>
            `;

            // Update active state
            document.querySelectorAll('.layer').forEach(l => l.classList.remove('active'));
            document.querySelector(`[data-layer="${layer}"]`).classList.add('active');

            panel.classList.add('active');
        }

        function hideDetail() {
            document.getElementById('detail-panel').classList.remove('active');
            document.querySelectorAll('.layer').forEach(l => l.classList.remove('active'));
        }

        // Show flow
        function showFlow(flow) {
            document.querySelectorAll('.flow-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.flow-step-detail').forEach(detail => detail.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`flow-${flow}`).classList.add('active');
        }

        // Show tab
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        // Smooth scroll for navigation
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.querySelector(link.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
